<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存机制 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/6.a2648412.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/36.25276d0a.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/4.55b24f61.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/5.2d78771d.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/7.fd97ac92.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/8.2b28110d.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/advance/闭包.html" class="sidebar-link">关于闭包</a></li><li><a href="/advance/打包文件的hash名.html" class="sidebar-link">打包 hash 文件名</a></li><li><a href="/advance/客户端和服务端渲染.html" class="sidebar-link">客户端和服务端渲染</a></li><li><a href="/advance/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/advance/浏览器缓存机制.html" class="active sidebar-link">浏览器缓存机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#缓存的作用" class="sidebar-link">缓存的作用</a></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#强制缓存" class="sidebar-link">强制缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#缓存资源放在哪" class="sidebar-link">缓存资源放在哪？</a></li></ul></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#协商缓存" class="sidebar-link">协商缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#last-modified-if-modified-since" class="sidebar-link">Last-Modified/If-Modified-Since</a></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#etag-if-none-match" class="sidebar-link">Etag/If-None-Match</a></li></ul></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#清除缓存" class="sidebar-link">清除缓存</a></li><li class="sidebar-sub-header"><a href="/advance/浏览器缓存机制.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/advance/内存泄漏.html" class="sidebar-link">内存泄漏</a></li><li><a href="/advance/前端路由.html" class="sidebar-link">前端路由相关</a></li><li><a href="/advance/使用token.html" class="sidebar-link">登陆的流程</a></li><li><a href="/advance/事件循环.html" class="sidebar-link">事件循环</a></li><li><a href="/advance/手写题目.html" class="sidebar-link">手写题目</a></li><li><a href="/advance/手写flat.html" class="sidebar-link">手写 flat</a></li><li><a href="/advance/输入url到生成页面.html" class="sidebar-link">输入 url 到生成页面过程</a></li><li><a href="/advance/图片懒加载.html" class="sidebar-link">懒加载的实现</a></li><li><a href="/advance/网络攻击.html" class="sidebar-link">安全问题</a></li><li><a href="/advance/重绘和回流.html" class="sidebar-link">重绘和回流</a></li><li><a href="/advance/axios的基本使用.html" class="sidebar-link">axios 的使用</a></li><li><a href="/advance/axios高级.html" class="sidebar-link">axios 高级</a></li><li><a href="/advance/jsonp原理.html" class="sidebar-link">jsonp</a></li><li><a href="/advance/offset的高度.html" class="sidebar-link">offsetTop 以及相关高度</a></li><li><a href="/advance/防抖和节流.html" class="sidebar-link">防抖与节流</a></li><li><a href="/advance/跨域.html" class="sidebar-link">跨域的解决方案</a></li><li><a href="/advance/浏览器存储.html" class="sidebar-link">cookie  Localstorage  SessionStorage  区别</a></li><li><a href="/advance/ajax工作原理.html" class="sidebar-link">AJAX 工作原理</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器缓存机制"><a href="#浏览器缓存机制" class="header-anchor">#</a> 浏览器缓存机制</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>这部分知识会涉及到 缓存服务器(代理服务器)，以及 http 首部的 catch-control 字段。</p> <p>我们借了解浏览器缓存机制，也顺便复习一下，之前的这些知识。</p> <h2 id="缓存的作用"><a href="#缓存的作用" class="header-anchor">#</a> 缓存的作用</h2> <p>缓存的作用其实很容易理解。</p> <ol><li><p>一方面，如果本地有缓存，就可以用本地资源，而不必请求服务器了，页面加载速度肯定要快的多。</p></li> <li><p>另一方面，由于没有请求服务器，也侧面的缓解了服务器的压力。</p></li></ol> <p>当然，如果缓存多了，不清理的话，也可能导致浏览器卡顿。</p> <p>具体缓存流程如下图：</p> <p><img src="/assets/img/cache.67f5540d.jpg" alt=""></p> <hr> <p>下面我们来介绍浏览器的两种缓存解决办法。</p> <h2 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h2> <p>首先，我们明确一些前提，</p> <ol><li><p>第一次访问时肯定是没有缓存的，</p></li> <li><p>第一次请求接受到了响应后，浏览器如何知道哪些资源该缓存，哪些又不需要呢？唯一的信息就在响应头部了。</p></li> <li><p>事实上，也确实是在响应头部，告诉浏览器，我这次响应的资源是否缓存，缓存多久就失效了。</p></li> <li><p>而这些信息一般由两个响应头部字段控制，Cache-Control，Expires。</p></li></ol> <hr> <p>所以我们先来了解这两个字段。</p> <p><strong>Cache-Control</strong><br>
, 见名知意，就是控制缓存相关的。我们来看看它有哪些值。</p> <table><thead><tr><th>值</th> <th>解释</th></tr></thead> <tbody><tr><td>public</td> <td>所有内容都将被缓存(客户端和代理服务器都可缓存)</td></tr> <tr><td>private</td> <td>所有内容只有客户端可以缓存，默认值</td></tr> <tr><td>no-cache</td> <td>客户端缓存内容，但是否使用缓存则需要经过协商缓存来验证决定(稍后会介绍)</td></tr> <tr><td>no-store</td> <td>所有内容都不会被缓存</td></tr> <tr><td>max-age= x</td> <td>x 秒后，缓存会失效</td></tr></tbody></table> <p>代理服务器基本和 cdn 原理一样，代理服务器保存源服务器的一些内容，请求命中时，直接返回响应。</p> <p><strong>expires</strong></p> <p>它是 http/1.0 实现缓存的方式，仅做了解即可，因为它与 cache-control 同时出现的时候，后者是优先考虑，存在的理由是考虑兼容。<br>
它的值，是缓存过期的时间，但由于各国时间不同，因此不准确。</p> <hr> <p>通过上的描述，我们知道了缓存如何告知浏览器，那么缓存资源存在哪呢?</p> <p>来看打开自己的博客，资源请求情况：</p> <p><img src="/assets/img/cache1.dd38f9f8.jpg" alt=""></p> <p>size 的部分显示的是，请求资源的大小，我们刷新一遍再看。</p> <p><img src="/assets/img/cache2.d1d67b6c.jpg" alt=""></p> <p>再看 size 部分，显示的是 diskcache,说明资源是从 diskcache 来的</p> <p>再刷新一次(得间隔很短时间很刷新哦，这个很重要，因为时间过长的话，看不到下面结果)</p> <p><img src="/assets/img/cache3.41a86296.jpg" alt=""></p> <p>再看红圈的 size 部分，显示的是 memorycache，说明资源文件是从 memorycache 来的。</p> <p>很明显，diskcache 就是硬盘上的缓存了，一般是存储在文件中的 ，memorycache，是内存上的缓存，进程执行完就删除。</p> <p>很 cpu 运行很像，浏览器优先考虑用 内存中的资源(因为读取块)，也就是 memorycache，没有才用外部(硬盘文件)</p> <p>但，memorycache 保存的时间很短(因为内存空间比较小，不可能放太多东西)，一段时间后，相关进程关闭，memorycache 也就自动删除了。</p> <p>这也解释了为什么第二次刷新为什么要间隔很短操作。</p> <h3 id="缓存资源放在哪"><a href="#缓存资源放在哪" class="header-anchor">#</a> 缓存资源放在哪？</h3> <p>memorycache 里面的东西，我们不好查看，但是 diskcache 既然是文件形式，我们就能再磁盘中找到它。</p> <p>以 Google 浏览器为例子。</p> <p>这部分文件存储路径如下：</p> <p><strong>C:\Users\username(自己的用户名)\AppData\Local\Google\Chrome\User Data\Default\Cache</strong></p> <p>我们打开后如下：</p> <p><img src="/assets/img/cache4.e00e0f08.jpg" alt=""></p> <p>很遗憾，我们无法打开这里的文件，也看不懂它是什么。</p> <p>这里就可以用一个工具 ChromCacheView</p> <p>打开后，它会自动打开上面目录的 cache 文件夹，然后给我们显示的结果如下：</p> <p><img src="/assets/img/cache5.f2a009ec.jpg" alt=""></p> <p>看到这里，应该就能明白存储的是什么了，是的，是 http 响应报文。</p> <p>这便是我们的 diskcache 里的内容。</p> <p>同样，我们也能类比出 ，memorycache 中存的也是 http 响应报文。</p> <hr> <p>似乎有些扯远了，我们还是回到强制缓存。</p> <p>强制缓存就是请求时先 查找浏览器的缓存结果，再根据该结果来确定是否用该缓存结果</p> <p>请求时一般会碰到这四种情况</p> <ol><li><p>第一次请求， 没有缓存。</p></li> <li><p>虽然不是第一次请求，但是之前收到的响应报文没有叫我缓存，于是得继续向服务器发请求。</p></li> <li><p>之前收到的报文由明确叫我缓存，浏览器缓存了，但是查到后发现，有效时间过了(max-age),于是该缓存就没啥用了，还得重新请求。</p></li> <li><p>查到浏览器的缓存了，且还在有效期，于是就不请求了，直接返回之前缓存的结果。</p></li></ol> <hr> <p>在看 第三条 的时候，是不是觉得很遗憾？，我明明缓存了呀，虽然有效期过了，但说不定你服务器中的资源没有改变呢？</p> <p>那我还是可以用这个缓存的资源，于是，浏览器就先不急着请求服务器的响应报文，先和浏览器协商一下，问一下，自己的缓存还能不能用。</p> <p>于是也引起了我们第二种缓存——协商缓存。</p> <h2 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h2> <p>接着上一节的结尾说，浏览器和服务器协商的方法有两种(肯定都是通过首部来协商)。</p> <h3 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" class="header-anchor">#</a> Last-Modified/If-Modified-Since</h3> <p>Last-Modified 是响应报文的一个字段，用户告诉该报文最后修改的时间。</p> <p>If-Modified-Since 是请求报文的一个字段，值是上一次响应报文的 Last-Modified。</p> <p>也就是说，浏览器把 If-Modifed-Since 字段发出去后，服务器就可以和服务器上该资源最后修改的时间进行对比</p> <p>如果时间是一样的(没有修改过)。</p> <p>就返回  304 Not Modified</p> <p>告诉浏览器，放心用那份缓存资源吧，还有用的，我就不重复发一份了，毕竟都一样。</p> <p>如果，最后修改的时间大于 If-Modified-Since 的话，说明真的失效了，得重新发一份。</p> <h3 id="etag-if-none-match"><a href="#etag-if-none-match" class="header-anchor">#</a> Etag/If-None-Match</h3> <p>如果，在服务器响应的时候，给该资源一个独一无二的标签 Etag。</p> <p>并且服务器默认规定，只要资源不更新，该资源就始终对应这个 Etag，资源更新就重新生成一个独一无二的 Etag(和之前的不同)</p> <p>那么，请求时，就可以设置 if-none-match 字段，并把值赋为 Etag。</p> <p>待服务器接收到请求报文后，就会根据这个 if-none-match 的值来匹配，看是否有资源的 Etag 是这个。</p> <p>如果有，说明资源未更新，返回 304 Not Modified.</p> <p>如果没有，说明资源更新了，在响应中返回新的资源，返回 200 OK</p> <h2 id="清除缓存"><a href="#清除缓存" class="header-anchor">#</a> 清除缓存</h2> <p>如果想清除缓存的话，</p> <ul><li><p>f5 刷新网页会跳过强制缓存，但是会检查协商缓存。</p></li> <li><p>ctrl+f5 刷新网页的话，直接从服务器加载资源，强制缓存和协商缓存都会跳过</p></li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>之前，学过，为什么 webpack 打包 js ，css 这些资源文件的时候是以一个唯一的 hash 码命名，且重新打包后，又会重新生成新的不一样的 hash 码文件名。</p> <p>放在这里来理解一下。当服务器的资源更新时，webpack 会重新打包，生成新的 hash 文件名(所有打包后的文件)</p> <p>带来的好处是，如果缓存的资源还在有效期，但在这期间服务器改动资源，浏览器是请求不到新的资源的。</p> <p>通过 webpack 的打包，就能实施实时更新。</p> <p>但是，坏处是，之前的强缓存就会全部失效，因为文件名都不同了(url 自然也不同了)，浏览器以为在请求不同资源呢。</p> <p>带来的是，协商缓存也跟着失效，因为浏览器以为自己没有要请求资源的缓存，自然不会去关注过期。更不会去协商。</p> <p>如果我觉得要改进的话，最好，是 webpack 打包时只重新为那些更改了文件重新生成 hash 值。</p> <p>如果能做到这点的话，就没有必要设置过期时间了，因为一更新文件名就会改变，就会立马知道。于是协商缓存就没有必要存在了。</p> <p>参考：https://juejin.cn/post/6844903593275817998
http://cn.tipsandtricks.tech/%E5%A6%82%E4%BD%95%E4%BB%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B%E7%BC%93%E5%AD%98%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%92%8C%E6%96%87%E4%BB%B6</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/advance/垃圾回收.html" class="prev">
        垃圾回收
      </a></span> <span class="next"><a href="/advance/内存泄漏.html">
        内存泄漏
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/6.a2648412.js" defer></script>
  </body>
</html>
