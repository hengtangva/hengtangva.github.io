<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安全问题 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/36.25276d0a.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/4.55b24f61.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/5.2d78771d.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/6.a2648412.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/7.fd97ac92.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/8.2b28110d.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/advance/闭包.html" class="sidebar-link">关于闭包</a></li><li><a href="/advance/打包文件的hash名.html" class="sidebar-link">打包 hash 文件名</a></li><li><a href="/advance/客户端和服务端渲染.html" class="sidebar-link">客户端和服务端渲染</a></li><li><a href="/advance/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/advance/浏览器缓存机制.html" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/advance/内存泄漏.html" class="sidebar-link">内存泄漏</a></li><li><a href="/advance/前端路由.html" class="sidebar-link">前端路由相关</a></li><li><a href="/advance/使用token.html" class="sidebar-link">登陆的流程</a></li><li><a href="/advance/事件循环.html" class="sidebar-link">事件循环</a></li><li><a href="/advance/手写题目.html" class="sidebar-link">手写题目</a></li><li><a href="/advance/手写flat.html" class="sidebar-link">手写 flat</a></li><li><a href="/advance/输入url到生成页面.html" class="sidebar-link">输入 url 到生成页面过程</a></li><li><a href="/advance/图片懒加载.html" class="sidebar-link">懒加载的实现</a></li><li><a href="/advance/网络攻击.html" class="active sidebar-link">安全问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#csrf-跨站请求攻击" class="sidebar-link">CSRF 跨站请求攻击</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#针对-http-get-的-csrf-攻击" class="sidebar-link">针对 HTTP GET 的 CSRF 攻击</a></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#针对-htpp-post-请求的-csrf-攻击" class="sidebar-link">针对 HTPP POST 请求的 CSRF 攻击</a></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#防御措施" class="sidebar-link">防御措施</a></li></ul></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#xss-跨站脚本攻击" class="sidebar-link">XSS 跨站脚本攻击</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#存储型-xss" class="sidebar-link">存储型 xss</a></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#反射型-xss" class="sidebar-link">反射型 xss</a></li><li class="sidebar-sub-header"><a href="/advance/网络攻击.html#如何预防-xss" class="sidebar-link">如何预防 xss</a></li></ul></li></ul></li><li><a href="/advance/重绘和回流.html" class="sidebar-link">重绘和回流</a></li><li><a href="/advance/axios的基本使用.html" class="sidebar-link">axios 的使用</a></li><li><a href="/advance/axios高级.html" class="sidebar-link">axios 高级</a></li><li><a href="/advance/jsonp原理.html" class="sidebar-link">jsonp</a></li><li><a href="/advance/offset的高度.html" class="sidebar-link">offsetTop 以及相关高度</a></li><li><a href="/advance/防抖和节流.html" class="sidebar-link">防抖与节流</a></li><li><a href="/advance/跨域.html" class="sidebar-link">跨域的解决方案</a></li><li><a href="/advance/浏览器存储.html" class="sidebar-link">cookie  Localstorage  SessionStorage  区别</a></li><li><a href="/advance/ajax工作原理.html" class="sidebar-link">AJAX 工作原理</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安全问题"><a href="#安全问题" class="header-anchor">#</a> 安全问题</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>对于安全问题，前端主要关注的是 CSRF 和 XSS 攻击</p> <p>这里就先对这两个攻击方法进行讨论，以及预防。</p> <h2 id="csrf-跨站请求攻击"><a href="#csrf-跨站请求攻击" class="header-anchor">#</a> CSRF 跨站请求攻击</h2> <p>一般能攻击，肯定就是有漏洞存在，我们来看看是什么漏洞，让 CSRF 攻击能发挥其作用。</p> <p>首先，我们知道，对于一个域发起请求，如果前一次服务器留有 cookie 的话，下次请求就会带上 cookie(如果浏览器允许的话)</p> <p>注意到的是，只要是这个浏览器发送请求，无论从哪个页面发起的请求，都会带上 cookie</p> <p>而服务器是不知道是哪个页面发起的请求，只知道是这个客户发来的请求(凭借 识别 cookie)</p> <p>而有些 cookie 是用来进行身份验证的。</p> <p>这就造成了，如果有恶意网站发送同样的请求，并希望服务器更改数据，服务器是分别不出来的，它就会照做。</p> <p>来看图，看攻击是如何发生的。</p> <p><img src="/assets/img/csrf.21be9312.jpg" alt=""></p> <hr> <p>接下来我们来具体的讲一下，如何发送一个 csrf 攻击</p> <h3 id="针对-http-get-的-csrf-攻击"><a href="#针对-http-get-的-csrf-攻击" class="header-anchor">#</a> 针对 HTTP GET 的 CSRF 攻击</h3> <p>大部分的请求主要是 get 和 post</p> <p>我们先来看如何在用户不知道的情况下，如何偷偷发送一个 get 请求</p> <p>我们以一个例子来看</p> <hr> <p>假设有一个基于 Web 的网上银行的网址是 www.banker32.com</p> <p>它允许用户将自己的资金转到其他人账户上，当然在用户执行该操作之前要登陆该网银行。</p> <p>一旦用户登陆，服务器会返回一个会话 cookie ，它标识该用户已经通过了身份验证。</p> <p>汇款请求需要一个有效的会话 cookie 否则是不会处理的，而这个 cookie 在登陆状态是给了浏览器的。</p> <p>用户可以发送以下请求，来执行转账操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>banker32<span class="token punctuation">.</span>com<span class="token operator">/</span>transder<span class="token punctuation">.</span>php<span class="token operator">?</span>to<span class="token operator">=</span><span class="token number">3220</span><span class="token operator">&amp;</span>amount<span class="token operator">=</span><span class="token number">500</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该请求通知服务器上的 transfer.php 程序执行转账操作，向账号 3220 转账 500 美元。</p> <hr> <p>ok, 如果是用户自己发请求当然没有问题。</p> <p>但是，若是攻击者在用户登录状态是时(身份验证的 cookie 是在浏览器这边的)，让用户访问一个精心设计的网页。</p> <p>那么，攻击者就可以在这个网站上发送转账请求。</p> <p>至于发送 get 请求其实很简单，只需要在网页里加一个 img 或者 iframe 或者 script 标签即可。</p> <p>如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>http://www.banker32.com/transfer.php?to=3320&amp;amount=500<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样，解析到该标签时，就会自动发送请求，而用户是不知道的。而由于有之前的 cookie 作为验证，服务器的 transfer.php 会直接执行操作。</p> <h3 id="针对-htpp-post-请求的-csrf-攻击"><a href="#针对-htpp-post-请求的-csrf-攻击" class="header-anchor">#</a> 针对 HTPP POST 请求的 CSRF 攻击</h3> <p>还是上面的例子，若服务器只支持 post 请求，那么通过 img 标签就不管用了，但是，还是有方法让用户不知道的情况下，发送post 请求。</p> <p>我们可以通过 script 脚本动态生成一个表单，来看看是怎么做的。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fields <span class="token operator">+=</span> <span class="token string">&quot;&lt;input type='hidden' name='to' value='3220'&gt;&quot;</span><span class="token punctuation">;</span>
    fields <span class="token operator">+=</span> <span class="token string">&quot;&lt;input type='hidden' name='amount' value='500'&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    form<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token string">'http://www.banker32.com/postaction.php'</span><span class="token punctuation">;</span>
    form<span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token string">'post'</span><span class="token punctuation">;</span>
    form<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> fields<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
    form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 网页一加载完成就发起请求</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面的脚本中，我们动态生成了一个表单，方法是 post，</p> <p>注意到的是，我们把表单的的元素全部设置为了 hidden，即不让用户看到。</p> <p>解析恶意网页时，scrip 脚本自动执行，伪造请求也就直接发送出去了。</p> <p>当然，get 方法也可以这样做，只不过用 img 标签更为方便罢了。</p> <h3 id="防御措施"><a href="#防御措施" class="header-anchor">#</a> 防御措施</h3> <p>我们学习这个。肯定不是为了去攻击别人，肯定是想自己的网站避免被攻击。</p> <p>那么如何预防 CSRF 攻击呢？</p> <p>我们还是回到开头，看看症结在哪，我们在来对症下药。</p> <p>首先，由于服务器时服务区别请求是否跨站的，但是浏览器可以区别的啊。</p> <p>所以我们可以从浏览器这边入手，跨站请求就不发送就可以了。</p> <ol><li>同站 cookie</li></ol> <p>很多浏览器其实已经支持了该方法，</p> <p>具体实现是给 cookie 增加一个属性 SameSite, 它有两个值</p> <p>该属性由服务器进行设置，它告诉浏览器一个 cookie 是否可以被跨站请求使用</p> <ul><li><p>SameSite: strict  告诉浏览器该 cookie 只能被同站请求一起发送</p></li> <li><p>SameSite: lax  告诉浏览器该 cookie 只有在顶级导航的跨站请求才一起发送</p></li></ul> <ol start="2"><li>token</li></ol> <p>该方法应该是比较主流的做法。</p> <p>token 翻译过来是 令牌的意思</p> <p>也就是说，用户登录后，服务器会返回一个 token，当然 token 也可以存储在 cookie 里面。</p> <p>这时候你可能就有疑问了，那我 CSRF 不是可以借用 cookie 吗？ 你放到 cookie 里面又有什么用呢？</p> <p>实际上是这样的， CSRF 攻击只能借用一下 cookie，实际上是利用浏览器的弱点，而实际上它是获取不到 cookie 里的信息的。</p> <p>于是，我们自己发送的请求可以这样， http://www.xxxx.com/like?id=12365&amp;token=A23F267AE65</p> <p>看到了吗？ 请求里包含了 token 的数据，服务只需要验证 cookie 里的 token 和请求里的是否一样就 ok 了。</p> <p>而跨站伪造攻击，只能发送这样的请求，http://www.xxxx.com/like?id=12365   因为它不知道 token 的内容。</p> <p>当浏览器发现没有 token 的请求不受理就 ok 了。</p> <p>关于 token 的相关知识，建议看一下，登录流程那一部分，有较为详细的解释</p> <h2 id="xss-跨站脚本攻击"><a href="#xss-跨站脚本攻击" class="header-anchor">#</a> XSS 跨站脚本攻击</h2> <p>跨站脚本攻击是一种代码注入攻击，这种攻击通常涉及三个实体: 攻击者，被攻击用户，目标网站</p> <p>具体实现是怎样的呢？</p> <p>攻击者在填写表单或者其他信息的时候，写的是脚本攻击代码，若服务器不做处理的话，当别人访问攻击者的个人信息时，由于，浏览器碰到 script 标签就会执行里面的代码，而不把它当成数据来展示，这就导致了，这断脚本会在受害者浏览器上执行，从而攻击受害者</p> <p>典型的 xss 攻击有两种</p> <h3 id="存储型-xss"><a href="#存储型-xss" class="header-anchor">#</a> 存储型 xss</h3> <p>存储型 xss 就是我们上述描述的情况。</p> <p>攻击者可以直接把数据发送给目标网站，网站会对数据进行持久性储存。</p> <p>之后，如果网站将储存的数据发送给其他用户，那么就在攻击者和其他用户之间创建了一条通道</p> <h3 id="反射型-xss"><a href="#反射型-xss" class="header-anchor">#</a> 反射型 xss</h3> <p>不知道你有没有碰到这种情况，比如你用谷歌搜索 xyz 时，若没有搜索到，它将返回 ‘找不到与xyz相符的结果’</p> <p>很多网站其实都有这样的反射行为，即发出去的东西又被返回回来。</p> <p>我们往深的想一下，如果用户发的是恶意脚本呢？</p> <p>服务器可能也就会返回该恶意脚本，浏览器又默认执行，就攻击到了用户。</p> <p>你可能会想，用户不会那么傻，自己攻击自己。</p> <p>是的，但若是攻击做了一个很有吸引人的链接，用户点击了，那么该链接中包含的脚本就会返回到用户的浏览器并执行。</p> <p>比如假设有一个存在 xss 漏洞的网站服务：http://www.example.com/serach?input=word</p> <p>其中，word 由用户提供。</p> <p>若攻击者诱惑用户点击一个链接 ：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>http://www.example.com/search?input=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>alert('attack');<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么若服务器把 input 里面的数据返回，就会返回一个脚本，从而被浏览器执行，弹出 attack</p> <h3 id="如何预防-xss"><a href="#如何预防-xss" class="header-anchor">#</a> 如何预防 xss</h3> <p>浏览器肯定是做不了什么来预防的。</p> <p>所以能实现预防的是服务器。</p> <p>我们再来回顾一下，到达为什么会出现 xss 攻击。</p> <p>当我们的服务器希望接受的是数据时，恶意用户却给了脚本。那如何把脚本变成数据呢？</p> <p>很容易想到的是，将 script 标签转义一下，这样，返回给浏览器的数据就不会被当成脚本执行了。</p> <p>举个例子，若有一个恶意用户将恶意脚本注入到一个网页的文本区</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">alerr</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么服务拿到之后，要做如下的转义处理，将其转为下面的字符串</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token entity named-entity" title="&lt;">&amp;lt;</span> script <span class="token entity named-entity" title="&gt;">&amp;gt;</span> alert('attack') <span class="token entity named-entity" title="&lt;">&amp;lt;</span>/script <span class="token entity named-entity" title="&gt;">&amp;gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>浏览器再碰到的时候，就会解析成第一个代码中的字符串，但不会执行 js 脚本。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/advance/图片懒加载.html" class="prev">
        懒加载的实现
      </a></span> <span class="next"><a href="/advance/重绘和回流.html">
        重绘和回流
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/36.25276d0a.js" defer></script>
  </body>
</html>
