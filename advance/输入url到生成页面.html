<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>输入 url 到生成页面过程 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/4.55b24f61.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/36.25276d0a.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/5.2d78771d.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/6.a2648412.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/7.fd97ac92.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/8.2b28110d.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link router-link-active">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/advance/闭包.html" class="sidebar-link">关于闭包</a></li><li><a href="/advance/打包文件的hash名.html" class="sidebar-link">打包 hash 文件名</a></li><li><a href="/advance/客户端和服务端渲染.html" class="sidebar-link">客户端和服务端渲染</a></li><li><a href="/advance/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/advance/浏览器缓存机制.html" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/advance/内存泄漏.html" class="sidebar-link">内存泄漏</a></li><li><a href="/advance/前端路由.html" class="sidebar-link">前端路由相关</a></li><li><a href="/advance/使用token.html" class="sidebar-link">登陆的流程</a></li><li><a href="/advance/事件循环.html" class="sidebar-link">事件循环</a></li><li><a href="/advance/手写题目.html" class="sidebar-link">手写题目</a></li><li><a href="/advance/手写flat.html" class="sidebar-link">手写 flat</a></li><li><a href="/advance/输入url到生成页面.html" class="active sidebar-link">输入 url 到生成页面过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#url-的构成" class="sidebar-link">url 的构成</a></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#dns-域名解析" class="sidebar-link">DNS 域名解析</a></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#tcp-三次握手" class="sidebar-link">TCP 三次握手</a></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#发送-http-请求" class="sidebar-link">发送 HTTP 请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#报文和实体" class="sidebar-link">报文和实体</a></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#发送请求" class="sidebar-link">发送请求</a></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#响应报文" class="sidebar-link">响应报文</a></li></ul></li><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#浏览器解析渲染页面" class="sidebar-link">浏览器解析渲染页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advance/输入url到生成页面.html#tcp-的四次挥手" class="sidebar-link">TCP 的四次挥手</a></li></ul></li></ul></li><li><a href="/advance/图片懒加载.html" class="sidebar-link">懒加载的实现</a></li><li><a href="/advance/网络攻击.html" class="sidebar-link">安全问题</a></li><li><a href="/advance/重绘和回流.html" class="sidebar-link">重绘和回流</a></li><li><a href="/advance/axios的基本使用.html" class="sidebar-link">axios 的使用</a></li><li><a href="/advance/axios高级.html" class="sidebar-link">axios 高级</a></li><li><a href="/advance/jsonp原理.html" class="sidebar-link">jsonp</a></li><li><a href="/advance/offset的高度.html" class="sidebar-link">offsetTop 以及相关高度</a></li><li><a href="/advance/防抖和节流.html" class="sidebar-link">防抖与节流</a></li><li><a href="/advance/跨域.html" class="sidebar-link">跨域的解决方案</a></li><li><a href="/advance/浏览器存储.html" class="sidebar-link">cookie  Localstorage  SessionStorage  区别</a></li><li><a href="/advance/ajax工作原理.html" class="sidebar-link">AJAX 工作原理</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="输入-url-到生成页面过程"><a href="#输入-url-到生成页面过程" class="header-anchor">#</a> 输入 url 到生成页面过程</h1> <h2 id="url-的构成"><a href="#url-的构成" class="header-anchor">#</a> url 的构成</h2> <p>先来了解 url</p> <p>url：uniform resource locator  (统一资源定位符)。</p> <p>其作用是来定位网上的资源。</p> <p>这里还是想讲一下，uri 和 url 的区别。</p> <p>uri ： uniform resource identitifier  (统一资源标识符)</p> <p>就是用来唯一标识网上的一个资源。</p> <p>在回到 url 它是唯一定位网上的资源的，也就是说，给了 url 就能确定某个资源。(不正是 uri 的作用吗？)</p> <p>所以，url 是 uri 的一种实现方式，也可以说，url 是 uri 的子集。</p> <hr> <p>好了，由于我们用基本都用 url 来实现 uri 所以就只谈 url ，碰到 uri 其实也可以用 url 代替。以便理解。</p> <p>来看一个 url ：</p> <p><strong>scheme://host.domain:port/path/filename</strong></p> <p>一一解释各个部分表示意思。</p> <ul><li><p>scheme: 协议，常见的协议有，http， https，ftp，file。</p></li> <li><p>host：定义域主机，http 默认的是 www 。</p></li> <li><p>domain：域名，用于定位计算机地址,一般就是服务器地址。</p></li> <li><p>port：端口号，计算机上有很多端口号，服务器监听不同端口号，做不同的事。</p></li> <li><p>path：定义服务上的路径。</p></li> <li><p>file：服务器上的文件资源。</p></li></ul> <p>好了，现在我们输入了这个 url 来看浏览器接下来干什么。</p> <hr> <h2 id="dns-域名解析"><a href="#dns-域名解析" class="header-anchor">#</a> DNS 域名解析</h2> <p>IP 地址：</p> <p>IP 地址是用来唯一标识一个计算机的二进制数。</p> <p>ipv4 采用的是 32 位，但随着互联网的发展，发现 2 的 32 次方减 1 个 ip不够用了。</p> <p>于是出现了 ipv6，它用 128 位来表示 ip 地址，从而解决了 ip 不够用的问题。</p> <hr> <p>计算机的 ip 地址是一串数字，而域名是一串字符串(为了方便人记忆)。</p> <p>所以，我们首先要把字符串的域名解析为 ip 地址才能找到要请求交流的计算机。</p> <p>而这，就是我们的 DNS 的工作了。</p> <p>DNS 和 HTTP 一样，是应用层的协议。</p> <p>但这里的 DNS 我们可以理解为一个服务器，url 先发给 DNS 服务器，它返回一个 ip 。</p> <p><img src="/assets/img/dns.1edee9d6.png" alt=""></p> <p>至于 DNS 的查找过程，下面图可以清晰解释。</p> <p><img src="/assets/img/dns2.ce2e8017.jpg" alt=""></p> <p>这样，就得到 ip 地址了，最后把其他信息和 ip 地址一起发到公网上，找服务器。</p> <p>经过路由一站一站的中转，我们找到了要访问的计算机，接下来就是和它建立连接了。</p> <h2 id="tcp-三次握手"><a href="#tcp-三次握手" class="header-anchor">#</a> TCP 三次握手</h2> <p>首先，还是先了解一下 TCP 。</p> <p>TCP 位于 TCP/IP 协议中的传输层，上层就是应用层(http,https), 下层是网络层(ip)。</p> <ol><li><p>先是网络层的 IP 找到要连接的计算机，</p></li> <li><p>传输层的 TCP 建立连接，</p></li> <li><p>应用层的 HTTP 才能互相发送数据。</p></li></ol> <p>TCP 从网络层那里接受到数据包，此时的数据包包含了 <strong>传输的数据</strong> 和 <strong>TCP 首部</strong>。</p> <p>数据就是应用层我们要传输的数据，这里来看如何用 TCP 首部建立连接。</p> <p>tcp 首部：</p> <p><img src="/assets/img/tcphead.2f87bd2e.jpg" alt=""></p> <p>来分析一下首部包含的信息</p> <ul><li><p>TCP 端口号<br>
TCP 的连接需要四个要素的确定唯一的一个连接。<br>
（源IP,源端口号） + （目的IP,目的端口号）
所以 tcp 首部预留了两个 16 位作为端口号的存储，也就是说，端口号的范围是 1^16 = 65535,1024 以下是系统保留的。</p></li> <li><p>TCP 的序号和确认号</p> <ul><li>32 位序号 seq ：通过这个来确认发送数据包的有序。</li> <li>32 位确认号 ack ：tcp 对上一次 seq 的序号做出的序列号，用来响应 tcp 报文，给收到的 tcp 报文段的序号 seq 加 1。</li></ul></li> <li><p>TCP 的标志位：<br>
这里仅讲最常用的：</p> <ul><li>SYN: async, 同步标志位，用于建立会话连接。</li> <li>ACK: acknowledge, 确认标记位，对已接受的数据包进行确认。</li> <li>FIN: finsih， 完成标记位，表示已经没有数据要发送了， 即将关闭连接。</li></ul></li></ul> <hr> <p>okk， 了解了这些前置知识，我们再来看三次握手。<br>
s
直接看图吧：</p> <p><img src="/assets/img/tcphand.bc43e039.jpg" alt=""></p> <ul><li><p>第一次握手：<br>
客户端将 TCP 报文 SYN 标志位设为 1 ，表明请求建立连接<br>
随机生成一个序列号值 seq = j，指明连哪个端口。<br>
然后首部发送给服务器</p></li> <li><p>第二次握手：<br>
服务器收到 SYN = 1 后，知道客户端请求连接，所以设置：<br>
ACK = 1,表明收到了请求。<br>
SYN = 1,表明情求连接客户端。<br>
ack = J + 1,<br>
随机生成一个 seq = K.<br>
然后将首部发给客户端。</p></li> <li><p>第三次握手：<br>
客户端收到数据包后，检查 ack 是否为 J+1，如果正确就将标志位 ACK 设为 1 ，ack = K + 1,发送给服务器。<br>
服务器端检查 ack 是否为 K + 1, ACK 是否为 1 ，如果是，说明连接成功了，可以互发数据了。</p></li></ul> <p>为什么 TCP 要握手三次呢？</p> <p>目的是避免通信过程的错误，比如失效了的连接请求突然又发送传送到了服务端，而客户端可能因为网络不好，早就下线不在了，从而引起错误。</p> <p>这和人们打电话很相似。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>三次握手：<br>
‘喂，你听得到吗？’<br>
‘我听的到，你听得到我说话吗？’<br>
‘嗯，我听的到你说话’</p></div> <p>经过这三次确认，两人才能确认电话是好的，才能继续说话。</p> <p>好了，经过漫长的握手，建立连接，接下来就是应用层的 HTTP 的事情了。</p> <hr> <h2 id="发送-http-请求"><a href="#发送-http-请求" class="header-anchor">#</a> 发送 HTTP 请求</h2> <p>首先，明确一点，http 协议中，浏览器和服务器发送的是 http 报文。</p> <h3 id="报文和实体"><a href="#报文和实体" class="header-anchor">#</a> 报文和实体</h3> <p>这里得捋清楚实体和报文的概念：</p> <p>图解 http 上是这么说的：</p> <p>通常报文等于实体，只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。</p> <p>我是这样理解的，实体主体就是我们这边的数据，比如要发送 hello world，实体主体和报文主体都是 hello world。</p> <p>但是，当开始传输时，不可能原封不动把 hello world 发出去，我们要进行编码，如 crc 海明，等编码。</p> <p>编码后，我们要发的还是叫报文，但不能叫实体了，因为实体还是 hello world。</p> <p>但是，传输编码，我们是不用关心得，我们只在乎还没发送的信息，所以这里就统称报文。</p> <hr> <h3 id="发送请求"><a href="#发送请求" class="header-anchor">#</a> 发送请求</h3> <p>HTTP 请求报文由三部分构成：</p> <ol><li><p>请求行： 包含了请求方法，请求 uri，协议版本。</p></li> <li><p>请求首部： 包含了一些通信的信息，包括 cookie ，Content-Type 等等。</p></li> <li><p>请求主体： 即我们想发送的数据了。</p></li></ol> <p>如图：</p> <p><img src="/assets/img/httptext.8950ea10.png" alt=""></p> <p>请求报文发送给服务器后，再来看服务器的响应报文。</p> <hr> <h3 id="响应报文"><a href="#响应报文" class="header-anchor">#</a> 响应报文</h3> <p>响应报文也由三部分组成：</p> <ol><li><p>响应行： 包含了协议版本，状态码，以及解释状态码的原因短语。</p></li> <li><p>响应头部： 和请求头部一样，用于通信以及对响应体的描述。</p></li> <li><p>响应主体： 即我们要响应的数据。</p></li></ol> <p>其中还有很多细节，这里不详细解释，分到其他章节讲解。</p> <p>拿到数据后，我们 就可以解析数据并渲染页面了。</p> <hr> <h2 id="浏览器解析渲染页面"><a href="#浏览器解析渲染页面" class="header-anchor">#</a> 浏览器解析渲染页面</h2> <p>拿到响应的 html 文本后，浏览器会按如下图处理：</p> <p><img src="/assets/img/parse.f5028452.png" alt=""></p> <p>主要分为 5 个步骤：</p> <ol><li><p>浏览器解析 html 生成 dom 树，生成 dom 树是深度优先遍历的。</p></li> <li><p>解析 css 生成 css 树。</p></li> <li><p>将二者合起来生成 渲染树。</p></li> <li><p>根据渲染树计算每个节点的信息。</p></li> <li><p>根据计算的信息绘制页面。</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意的是，css 树没有生成的话，是没法生成渲染树的，也就是说整个页面都没法生成。</p> <p>这也是为什么 css 样式要写在 html 的前面。</p> <p>当浏览器碰到脚本的时候，会停止解析，去执行 js 的脚本，此时页面就会延迟得到。</p> <p>这也是为什么 js 脚本要放在 html 的最后面。</p></div> <hr> <p>数据传输完毕就要断开连接了，就由回到我们的 TCP</p> <h3 id="tcp-的四次挥手"><a href="#tcp-的四次挥手" class="header-anchor">#</a> TCP 的四次挥手</h3> <p>四次挥手过程如下图：</p> <p><img src="/assets/img/tcpwave.aaab84f3.jpg" alt=""></p> <p>再来详细了解四次挥手的细节。<br>
挥手请求可以是 client ，也可以是 server，我们以 client 请求分析</p> <ol><li><p>client 将 FIN = 1 没有东西要发送了，请求断开连接，<br>
随机生成一个 seq = X 保证顺序。</p></li> <li><p>server 将 ack = X + 1, ACK = 1,表示收到了你的断开请求。</p></li> <li><p>server 将 FIN = 1, 生成一个 seq = N 表示，我也没有东西向你发送了。</p></li> <li><p>client 收到 server 的报文后，将 ACK = 1, ack = N + 1, 表示我也收到你的关闭连接的请求了，可以断开连接的，然后 Client 进入 TIME_WAIT 阶段。 server 接受到报文后，就关闭了它这边的连接。<br>
client 等待 2MSL 时间后，依然没有收到回复，就知道 server 已经关闭连接了。自己也关闭连接。</p></li></ol> <hr> <p><strong>为什么有 4 次挥手</strong><br>
，其中两次是确认 client 没有资源发了，可以关闭 client 的连接<br>
另两次是却 server 也没东西发了，关闭 server 的连接。</p> <p><strong>为什么要等待 2MSL</strong></p> <p>MSL 是一个报文最大生存时间</p> <ul><li><p>第一点：保证TCP协议的全双工连接能够可靠关闭：由于IP协议的不可靠性或者是其它网络原因，导致了Server端没有收到Client端的ACK报文，那么Server端就会在超时之后重新发送FIN，如果此时Client端的连接已经关闭处于CLOESD状态，那么重发的FIN就找不到对应的连接了，从而导致连接错乱，所以，Client端发送完最后的ACK不能直接进入CLOSED状态，而要保持TIME_WAIT，当再次收到FIN的收，能够保证对方收到ACK，最后正确关闭连接。</p></li> <li><p>第二点：保证这次连接的重复数据段从网络中消失如果Client端发送最后的ACK直接进入CLOSED状态，然后又再向Server端发起一个新连接，这时不能保证新连接的与刚关闭的连接的端口号是不同的，也就是新连接和老连接的端口号可能一样了，那么就可能出现问题：如果前一次的连接某些数据滞留在网络中，这些延迟数据在建立新连接后到达Client端，由于新老连接的端口号和IP都一样，TCP协议就认为延迟数据是属于新连接的，新连接就会接收到脏数据，这样就会导致数据包混乱。所以TCP连接需要在TIME_WAIT状态等待2倍MSL，才能保证本次连接的所有数据在网络中消失。</p></li></ul> <p>参考；https://blog.fundebug.com/2019/02/28/what-happens-from-url-to-webpage/<br>
https://juejin.cn/post/6844904070000410631</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/advance/手写flat.html" class="prev">
        手写 flat
      </a></span> <span class="next"><a href="/advance/图片懒加载.html">
        懒加载的实现
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/4.55b24f61.js" defer></script>
  </body>
</html>
