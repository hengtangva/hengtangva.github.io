<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>htpp 1.0/1.1/2.0/3.0 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/5.2d78771d.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/36.25276d0a.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/4.55b24f61.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/6.a2648412.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/7.fd97ac92.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/8.2b28110d.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/net/TCP简介.html" class="sidebar-link">TCP 简介</a></li><li><a href="/net/TCP的报文.html" class="sidebar-link">TCP 的报文</a></li><li><a href="/net/TCP的连接管理.html" class="sidebar-link">TCP 的连接管理</a></li><li><a href="/net/TCP的窗口滑动.html" class="sidebar-link">/net/TCP的窗口滑动.html</a></li><li><a href="/net/TCP的超时时间.html" class="sidebar-link">TCP 的超时时间</a></li><li><a href="/net/TCP的拥塞机制.html" class="sidebar-link">/net/TCP的拥塞机制.html</a></li><li><a href="/net/http状态码.html" class="sidebar-link">http 的转态码</a></li><li><a href="/net/http首部.html" class="sidebar-link">http 的首部</a></li><li><a href="/net/http的get和post的区别.html" class="sidebar-link">get 和 post 区别</a></li><li><a href="/net/http和https.html" class="sidebar-link">http 和 https</a></li><li><a href="/net/http的版本.html" class="active sidebar-link">htpp 1.0/1.1/2.0/3.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/http的版本.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/net/http的版本.html#http-2-0" class="sidebar-link">http 2.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/http的版本.html#多路复用" class="sidebar-link">多路复用</a></li><li class="sidebar-sub-header"><a href="/net/http的版本.html#头部压缩" class="sidebar-link">头部压缩</a></li><li class="sidebar-sub-header"><a href="/net/http的版本.html#服务器推送" class="sidebar-link">服务器推送</a></li></ul></li><li class="sidebar-sub-header"><a href="/net/http的版本.html#http3-0" class="sidebar-link">http3.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/http的版本.html#http2-0-的问题" class="sidebar-link">http2.0 的问题</a></li><li class="sidebar-sub-header"><a href="/net/http的版本.html#quic" class="sidebar-link">QUIC</a></li></ul></li></ul></li><li><a href="/net/CDN原理.html" class="sidebar-link">CDN 原理</a></li><li><a href="/net/DNS原理.html" class="sidebar-link">DNS 的原理</a></li><li><a href="/net/cookie的作用.html" class="sidebar-link">cookie 的作用</a></li><li><a href="/net/SSL加密.html" class="sidebar-link">SSL 加密</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="htpp-1-0-1-1-2-0-3-0"><a href="#htpp-1-0-1-1-2-0-3-0" class="header-anchor">#</a> htpp 1.0/1.1/2.0/3.0</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <h2 id="http-2-0"><a href="#http-2-0" class="header-anchor">#</a> http 2.0</h2> <p>这里先主要讲一下 http 2.0</p> <p>提到 2.0  当然就得先提到 1.1 有哪些问题，然后 2.0 是如何解决这些问题的。</p> <ol><li><p>一个 tcp 连接上，一次只能发送一个请求，如果有多个请求，就会排队等待。</p></li> <li><p>头部冗余，采用文本格式传输。</p></li> <li><p>客户端需要主动发送请求。</p></li></ol> <p>再来看 http2.0 是如何解决这些问题的。</p> <h3 id="多路复用"><a href="#多路复用" class="header-anchor">#</a> 多路复用</h3> <p>名如其意， 多路复用就是考虑，让一个 tcp 连接能同时发送多个请求，当然和进程一下，这里是并行，不是并发。</p> <p>如下图：</p> <p><img src="/assets/img/http2roads.10aa5ead.jpeg" alt=""></p> <p>想要实现该如何做到呢？</p> <p>我们先来想象一下，多个请求并发的情况是如何。</p> <p>建立一个 tcp 连接后，客户端发一个请求，只有等到服务器返回响应了，才能发送下一个请求。</p> <p>但 http2 不一样，它可以在第一个请求还没收到响应就继续发另请求，</p> <p>带来的好处是，各个请求到接受反应的时间大大缩小。</p> <p>但也带来一个问题，就是比如第一个请求稍有些延迟，后一个请求先到了，并且后一个响应也先到浏览器这边。</p> <p>那么我怎么才能知道，哪个请求对应的响应是哪个呢？</p> <p>这时候就需要对发的数据进行编号，这也正是我们的 http2 所干的事情。</p> <hr> <p>我们这里还要说到一个概念  <strong>二进制分帧层</strong></p> <p>二进制分帧层介于应用层和传输层之间</p> <p>它会把 http2 传输的信息分隔为帧(frame)，并对他们采取二进制格式的编码，其中首部信息会被封装到 headers frame 中， request body 的数据则封装到 data frame 中，如下图所示</p> <p><img src="/assets/img/binary_framing.ae09920e.svg" alt=""></p> <p>到这里我们了解了。</p> <p>http2 主要是把 http报文 分为更小的数据块(帧)，并标记，编码成二进制。从而达到并行发送的效果，接收方，只需按照标记的规则把数据重组为 http 报文就 ok 了</p> <hr> <p>再接着了解一下几个概念，方便我们对后面的过程有更清楚的了解。</p> <ol><li><p>数据流： 已经建立连接内的双向字节流(一条发送，一条接收)，可以承载一条或者多条消息</p></li> <li><p>消息(message): 与逻辑请求或响应消息对应的完整的一系列帧，这里可以简单理解为一份 http 报文。</p></li> <li><p>帧： http/2 的最小通信单位，没个镇包含帧头，至少也会标识出当前帧所属的数据流。</p></li></ol> <p>将上述概念总结一下，就是</p> <ul><li><p>所有通信都在一个 tcp 连接上完成，此连接可以承载任意数量的双向数据流。</p></li> <li><p>每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。</p></li> <li><p>每条消息都是一条逻辑 http 消息(例如请求或者响应)，包含一个或者多个帧</p></li> <li><p>帧是最小的通信单位，承载着特定类型的数据，如 http 标头，消息负载等等，来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识重新组装</p></li></ul> <p>下面是一个传输过程的快照，方便来理解。</p> <p><img src="/assets/img/stream.47ba5b32.svg" alt=""></p> <p>总而言之，通过二进制分帧层，我们使得多路复用这个方法得以实现，从而大大提升传输效率。</p> <h3 id="头部压缩"><a href="#头部压缩" class="header-anchor">#</a> 头部压缩</h3> <p>每个 HTTP 传输都承载一组标头，这些标头说明了传输的资源及其属性。 在 HTTP/1.x 中，此元数据始终以纯文本形式，通常会给每个传输增加 500–800 字节的开销。如果使用 HTTP Cookie，增加的开销有时会达到上千字节。 为了减少此开销和提升性能，HTTP/2 使用 HPACK 压缩格式压缩请求和响应标头元数据，</p> <p>具体做法是维护表，将常见字段和值都放到表里。</p> <p>我们就可以把 头部用表中各个字段的索引代替，传到另一端的时候，只需查表，就可以恢复头部了。</p> <p>这样就把一个字段变成了一个字节的数字，从而大大压缩了头部的字段。</p> <p>表有两张，一张是静态的，即我们常用的，可以通官方网站查到</p> <p><img src="/assets/img/http2table.f6657a34.jpg" alt=""></p> <p>还有一张表是动态的，是可以随意添加的，比如之前传过来的头部有的字段和值不在表中，</p> <p>我们就可以将其加入表中，下次若还传一样的，只需传索引即可。</p> <p>若表中有的字段只给了名称，没有值 如 cookie ，便第一次可以用哈夫曼编码把这些值压缩再传递。</p> <h3 id="服务器推送"><a href="#服务器推送" class="header-anchor">#</a> 服务器推送</h3> <p>服务器推送也和字面理解差不多，即客户端没有发送请求，服务器也把数据发送过去。</p> <p>当然服务器不是乱发的。举个例子</p> <p>当客户端请求  html 页面时，服务器发现这个 html 文件还依赖一些其他的 css 文件，以及 js 文件，</p> <p>服务器就会通过服务器推送，把这些数据推送给客户端，(毕竟客户端肯定是要用的，既然请求了该 html 文件的话)</p> <p>总而言之，就是一份请求，发送多个响应。</p> <p>看图吧：</p> <p><img src="/assets/img/serverpush.d7598872.svg" alt=""></p> <h2 id="http3-0"><a href="#http3-0" class="header-anchor">#</a> http3.0</h2> <h3 id="http2-0-的问题"><a href="#http2-0-的问题" class="header-anchor">#</a> http2.0 的问题</h3> <p>在谈 http3.0 之前，我们还是先来看看 2.0 到底存在哪些问题，以致 3.0 的出现</p> <ol><li><p>建立连接时间长(tcp 三次握手)</p></li> <li><p>队头阻塞的问题</p></li> <li><p>弱网环境下，表现不佳</p></li></ol> <p>很明显，以上的缺陷基本都是它的底层协议 TCP 造成的，所以，http3.0 选用了 udp</p> <p>但是我们知道，udp 是无连接且不可靠的，所以自然不能直接用 udp</p> <p>于是 google 在其基础上改造出了一个新的协议 QUIC</p> <h3 id="quic"><a href="#quic" class="header-anchor">#</a> QUIC</h3> <p>QUIC 读作 quick 是 Quick UDP Internet Connections 的缩写，直译为 快速UDP互联网连接。</p> <p>而 HTTP3.0 又称为 HTTP Over QUIC</p> <p>先来看 http2 和 http3 的对比</p> <p><img src="/assets/img/http2and3.65a4fc54.jpg" alt=""></p> <hr> <p>ok， 下面来详细讲一下 QUICK</p> <ol><li>解决队头阻塞问题。</li></ol> <p>队头阻塞问题是这样的，当一数据包没有到达时，后面的数据也无法传达，http1 时，由于连接是单条的，也就是说，一个请求卡住了，可能导致后面的请求都拿不到数据。</p> <p>而 http2.0 通过多路复用解决了应用层上这个问题，</p> <p>但是，在传输层上，tcp 这个问题还是没有解决。</p> <p>因为 tcp 通过窗口传送时，若最前面的数据丢了，那么后面到达的数据始终会停留在缓冲区里，不会交给上层协议。</p> <p>但是，由于 QUICK 是基于 udp 的，一个连接可以有多个流，流与流之间是相互独立的，当一个流丢包时，影响的范围非常小。从而解决队头阻塞问题。</p> <ol start="2"><li>0RTT 连接</li></ol> <p>RTT 是数据包一来一回的时间。</p> <p>https 建立连接要 3次tcp 握手，5次 ssl 握手，要费很多时间。</p> <p>但是， QUIC 协议可以实现第一个包就包含有效数据。</p> <p>当然这是有条件的，第一次连接是要互相验证身份的。</p> <ul><li><p>首次连接</p> <p>首次连接是要验明身份的，因为要保证传输的可靠。</p> <p>而验证的方法类似于 ssl 加密，这里稍微提一下。</p> <ol><li><p>客户端首先发送一个 client hello 请求。</p></li> <li><p>服务端收到后，生成一个素数 p， 一个整数 q，一个随机数 Kspri 作为私钥，用 p，q，Kspri 计算出公钥，Kspub,然后把, p, q, Kspub 打包成 config 发送给客户端</p></li> <li><p>客户端拿到 config 后，随机生成自己的私钥 Kcpri, 同样用 p,q 生成自己的公钥 Kcpub。再用自己的私钥Kcpri 和 收到的 公钥Kspub，生成数据加密的秘钥 K 。最后，用这个秘钥 K 加密数据，并把自己的 公钥Kcpub 传给服务器</p></li> <li><p>服务器此时已经拿到加密的数据了，还有客户端的公钥，它也用对方的公钥 Kcpub 和自己的私钥 Kspri 生成加密的的秘钥 K ,来解开加密的密文。</p></li> <li><p>为了更加安全，服务器还会生成新生成的公钥和私钥，由于之前拿到了客户端的公钥 Kcpub， 因此可以用这个公钥和自己新的私钥生成新的秘钥 M, 再用 K 加密 M 把 M 和 新公钥传给客户端</p></li> <li><p>客户端用 K 解密后，拿到新的服务器公钥，和加密过后的 M ，于是用自己的私钥和新的服务器器公钥解出 M ,之后传输都用该秘钥M</p></li></ol></li></ul> <p><img src="/assets/img/quickconnect.82198cc3.jpg" alt=""></p> <ul><li>非首次连接</li></ul> <p>之前连接传输的 config 包，客户端可以存储下来，后续连接时可以直接使用，从而跳过连接，实现 0RRT</p> <p>当然，config 保存是有时间限制的，失效之后，仍要进行首次连接的交换。</p> <ol start="3"><li>连接迁移</li></ol> <p>由于用了 udp 连接，只需一个 64 位随机数作为连接 id，在 wifi 和 4g 切换的情况下，不需要重新建立连接。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/net/http和https.html" class="prev">
        http 和 https
      </a></span> <span class="next"><a href="/net/CDN原理.html">
        CDN 原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/5.2d78771d.js" defer></script>
  </body>
</html>
