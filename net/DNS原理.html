<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS 的原理 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/7.fd97ac92.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/36.25276d0a.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/4.55b24f61.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/5.2d78771d.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/6.a2648412.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/8.2b28110d.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/net/TCP简介.html" class="sidebar-link">TCP 简介</a></li><li><a href="/net/TCP的报文.html" class="sidebar-link">TCP 的报文</a></li><li><a href="/net/TCP的连接管理.html" class="sidebar-link">TCP 的连接管理</a></li><li><a href="/net/TCP的窗口滑动.html" class="sidebar-link">/net/TCP的窗口滑动.html</a></li><li><a href="/net/TCP的超时时间.html" class="sidebar-link">TCP 的超时时间</a></li><li><a href="/net/TCP的拥塞机制.html" class="sidebar-link">/net/TCP的拥塞机制.html</a></li><li><a href="/net/http状态码.html" class="sidebar-link">http 的转态码</a></li><li><a href="/net/http首部.html" class="sidebar-link">http 的首部</a></li><li><a href="/net/http的get和post的区别.html" class="sidebar-link">get 和 post 区别</a></li><li><a href="/net/http和https.html" class="sidebar-link">http 和 https</a></li><li><a href="/net/http的版本.html" class="sidebar-link">htpp 1.0/1.1/2.0/3.0</a></li><li><a href="/net/CDN原理.html" class="sidebar-link">CDN 原理</a></li><li><a href="/net/DNS原理.html" class="active sidebar-link">DNS 的原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/DNS原理.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-工作原理" class="sidebar-link">DNS 工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-服务器类型" class="sidebar-link">DNS 服务器类型</a></li><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-工作流程" class="sidebar-link">DNS 工作流程</a></li><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-缓存" class="sidebar-link">DNS 缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-报文与记录" class="sidebar-link">DNS 报文与记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/DNS原理.html#dns-记录" class="sidebar-link">DNS 记录</a></li><li class="sidebar-sub-header"><a href="/net/DNS原理.html#报文" class="sidebar-link">报文</a></li></ul></li></ul></li><li><a href="/net/cookie的作用.html" class="sidebar-link">cookie 的作用</a></li><li><a href="/net/SSL加密.html" class="sidebar-link">SSL 加密</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dns-的原理"><a href="#dns-的原理" class="header-anchor">#</a> DNS 的原理</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>DNS 主要功能就是 提供 主机名 转 IP 服务的。</p> <p>他是一个协议，在应用层，运行在 UDP 之上，使用 53 号端口。</p> <p>它也是一个由分层 DNS 服务器实现的分布式数据库。</p> <hr> <p>了解了 DNS 是什么，我么再来看它的工作原理。</p> <h2 id="dns-工作原理"><a href="#dns-工作原理" class="header-anchor">#</a> DNS 工作原理</h2> <p>先来看一个最简单的例子。</p> <p>当我们在浏览器中输入一个 url 之后会发生什么呢？</p> <ul><li><p>同一台用户主机上运行着 DNS 应用的客户端。</p></li> <li><p>浏览器将上述 url 中抽取出 主机名，并将主机名，传给 DNS 应用客户端。</p></li> <li><p>DNS 客户端向 DNS 服务器发送一个包含主机名的请求。</p></li> <li><p>DNS 服务器返回一个包含 IP 地址的报文给 DNS 客户端，并转交给浏览器。</p></li> <li><p>流浪器拿到 ip 后，立即向该 ip 地址的 80 端口的 HTTP 服务器发起 TCP 连接。</p></li></ul> <p><img src="/assets/img/dnssimple.ad381620.jpg" alt=""></p> <hr> <p>对用户来说，DNS 就像一个黑盒子，主机名进去，ip 出来。接下来我们来打开这个黑盒子，看看它到底干了什么。</p> <h3 id="dns-服务器类型"><a href="#dns-服务器类型" class="header-anchor">#</a> DNS 服务器类型</h3> <p>DNS 应用程序在我们客户端，主要就是把浏览器转交的 主机名 发送出去，得到 ip 再转交给 浏览器。这里不多谈。</p> <p>我们更关注的是 DNS 的服务器。</p> <p>下面是 DNS 服务器的种类。</p> <ol><li><p>根 DNS 服务器：</p> <ul><li><p>有 400 多个 根 DNS 服务器遍及全世界，它们由十三个不同组织管理。</p></li> <li><p>根 DNS 服务器 主要提供 TLD(顶级域名)服务器的地址。</p></li></ul></li> <li><p>TLD(top-level domain) DNS 服务器：</p> <ul><li><p>对于每一个顶级域(如 .com  .org   .edu) 和所有国家的顶级域(如：.ca  .jp  .fr) 都有 TLD 服务器.</p></li> <li><p>TLD 服务器提供了权威服务器的 ip 地址。</p></li></ul></li> <li><p>权威 DNS 服务器：</p> <ul><li><p>在因特网上具有公共可访问主机(如 web 服务器)的每个组织必须提供公共可访问的 DNS 记录。这些记录将 主机名 映射成 ip 地址。而，一些组织的权威服务器收藏了这些 DNS 记录。</p></li> <li><p>当然也可以支付费用，把这些记录存在服务器提供商的 权威服务器中</p></li></ul></li> <li><p>本地 DNS 服务：</p> <ul><li><p>主机的本地 DNS 服务器通常邻近本主机。</p></li> <li><p>对某机构 ISP 而言，本地 DNS 服务器可能就和主机在一个局域网中。</p></li> <li><p>对某居民区而言，本地 DNS 服务器通常与主机相隔不超过几台服务器。</p></li></ul></li></ol> <hr> <p>严格来说，本地 DNS 服务器并不属于 DNS 服务器的层次结构，其层次结构如下：</p> <p><img src="data:image/jpeg;base64,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" alt=""></p> <h3 id="dns-工作流程"><a href="#dns-工作流程" class="header-anchor">#</a> DNS 工作流程</h3> <p>先来看图，我们按照图片来分析</p> <p><img src="/assets/img/dns2.ce2e8017.jpg" alt=""></p> <ol><li><p>假设主机想知道 www.163.com 的 ip</p></li> <li><p>首先向本地 DNS 服务器发送报文。</p></li> <li><p>本地DNS服务器转发到根服务器，根服务器返回对应顶级域服务器 ip 地址，这里是 .com</p></li> <li><p>于是，本地DNS服务器拿到这个 ip 后，就向 .com DNS服务器发送报文。顶级域服务器返回对应的权威服务器的 ip</p></li> <li><p>本地服务器又拿到该 ip 去请求 权威DNS服务器 163.com，它里面存在对应的 ip 地址，将其返回。</p></li> <li><p>于是本地 DNS 服务拿到想要的 ip 就转发给 DNS 客户端，再转给浏览器。</p></li></ol> <hr> <p>我们顺便来了解一下两种查询方式，迭代查询，递归查询</p> <p><strong>递归查询</strong><br>
图中 step1 和 step2 是递归查询<br>
递归查询很像深度遍历。</p> <p><strong>迭代查询</strong><br>
图中 step2 step4 step6 是迭代查询<br>
迭代查询很像广度遍历。</p> <p>当然也可以全部都用递归查询，如下图：</p> <p><img src="/assets/img/redns.1ac2bd3c.jpg" alt=""></p> <p>不过，通常查询不会采取这种模式，一般是我们分析的那种查询方式。<br>
即，请求主机到本地DNS 是递归的，其余都是迭代的。</p> <h3 id="dns-缓存"><a href="#dns-缓存" class="header-anchor">#</a> DNS 缓存</h3> <p>实际上，不可能所有的 DNS 查询都要走这么多弯，因为我们没个服务器都是有缓存的。</p> <p>当第一次访问后，就会有缓存。比如我们访问过一次 www.163.com 后，本地服务器下次就可以直接在自己缓存中找到其对应 ip 了，不用费更多功夫。</p> <p>通常，DNS 服务器缓存时间是 2 天，两天过后自动抛弃。</p> <p>而且，有了缓存的存在，几乎没有查询会经过 根DNS服务器 了。</p> <h2 id="dns-报文与记录"><a href="#dns-报文与记录" class="header-anchor">#</a> DNS 报文与记录</h2> <p>DNS 中的记录中储存了 资源记录到 ip 的映射，且每个回答报文中都会包含一条或多条记录。</p> <h3 id="dns-记录"><a href="#dns-记录" class="header-anchor">#</a> DNS 记录</h3> <p>DNS 记录是包含下列字段的四元组。</p> <p><strong>(name, value, type, ttl)</strong></p> <ul><li><p>TTL 是该记录的生存时间，规定多少时间后，自动删除该条记录。</p></li> <li><p>name 和 type 值取决于 type</p></li> <li><p>我们重点来看 type。</p> <ol><li><p>Type = A, address，表明 name 是主机名，value 是主机对应的 ip</p></li> <li><p>Type = CNAME, canonical name, 表明 value 是别名为 name 的主机对应的规范主机名，也就是说，访问 name 其实就是访问 value，那你就反问 value 去吧。例子可以看 cdn 原理。如：<br>
(foo.com, relay1.bar.foo.com, CNAME,145.37.45.34)</p></li> <li><p>Type = NS, 则 name 是个域，而 value 是如何获得该域中主机 ip 地址 的权威DNS服务器的主机名，这个记录用于查询链来路由DNS查询。</p></li> <li><p>Type = MX, 表明 value 是别名为 name 的邮件服务器规范主机名，这里仅做了解。</p></li></ol></li></ul> <h3 id="报文"><a href="#报文" class="header-anchor">#</a> 报文</h3> <p>报文暂时搁置在这，因为没碰到过，给幅图，仅做了解。</p> <p><img src="/assets/img/dnsmessage.104423da.jpg" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/net/CDN原理.html" class="prev">
        CDN 原理
      </a></span> <span class="next"><a href="/net/cookie的作用.html">
        cookie 的作用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/7.fd97ac92.js" defer></script>
  </body>
</html>
