<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP 简介 | Valjeanth&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="我亦飘零久，十年来，深恩负尽">
    
    <link rel="preload" href="/assets/css/0.styles.60dd0459.css" as="style"><link rel="preload" href="/assets/js/app.0ca42ae6.js" as="script"><link rel="preload" href="/assets/js/2.515f669a.js" as="script"><link rel="preload" href="/assets/js/8.2b28110d.js" as="script"><link rel="prefetch" href="/assets/js/10.4260b3ca.js"><link rel="prefetch" href="/assets/js/100.6421f402.js"><link rel="prefetch" href="/assets/js/101.753d4f5a.js"><link rel="prefetch" href="/assets/js/102.04d0f91c.js"><link rel="prefetch" href="/assets/js/103.fce5b587.js"><link rel="prefetch" href="/assets/js/104.0c1d91c6.js"><link rel="prefetch" href="/assets/js/105.6fc090b0.js"><link rel="prefetch" href="/assets/js/106.eb04df43.js"><link rel="prefetch" href="/assets/js/107.1ed6d9d7.js"><link rel="prefetch" href="/assets/js/108.49134f48.js"><link rel="prefetch" href="/assets/js/109.46747f86.js"><link rel="prefetch" href="/assets/js/11.88b87b82.js"><link rel="prefetch" href="/assets/js/110.741b0788.js"><link rel="prefetch" href="/assets/js/111.8ad168c8.js"><link rel="prefetch" href="/assets/js/112.1dd92670.js"><link rel="prefetch" href="/assets/js/113.36b21cde.js"><link rel="prefetch" href="/assets/js/114.8c3be7f7.js"><link rel="prefetch" href="/assets/js/115.aa32a5a3.js"><link rel="prefetch" href="/assets/js/116.c623be61.js"><link rel="prefetch" href="/assets/js/117.f301d9c7.js"><link rel="prefetch" href="/assets/js/118.58eb2a6e.js"><link rel="prefetch" href="/assets/js/119.84201e70.js"><link rel="prefetch" href="/assets/js/12.ba2c56b3.js"><link rel="prefetch" href="/assets/js/120.d4f914fb.js"><link rel="prefetch" href="/assets/js/121.11bc675f.js"><link rel="prefetch" href="/assets/js/122.532b2aa0.js"><link rel="prefetch" href="/assets/js/123.8f7cab97.js"><link rel="prefetch" href="/assets/js/124.dc742648.js"><link rel="prefetch" href="/assets/js/125.6a76c691.js"><link rel="prefetch" href="/assets/js/126.ba2f5e66.js"><link rel="prefetch" href="/assets/js/127.6e07b924.js"><link rel="prefetch" href="/assets/js/128.82fc423e.js"><link rel="prefetch" href="/assets/js/129.d9481933.js"><link rel="prefetch" href="/assets/js/13.976410ef.js"><link rel="prefetch" href="/assets/js/130.ee749818.js"><link rel="prefetch" href="/assets/js/131.b4dd6ab8.js"><link rel="prefetch" href="/assets/js/132.11d6a700.js"><link rel="prefetch" href="/assets/js/133.ef42d156.js"><link rel="prefetch" href="/assets/js/134.d21933e8.js"><link rel="prefetch" href="/assets/js/135.e324a67b.js"><link rel="prefetch" href="/assets/js/136.ae22e3fd.js"><link rel="prefetch" href="/assets/js/137.44125a63.js"><link rel="prefetch" href="/assets/js/138.90654653.js"><link rel="prefetch" href="/assets/js/139.0ebaf63b.js"><link rel="prefetch" href="/assets/js/14.e80a197e.js"><link rel="prefetch" href="/assets/js/140.2079d708.js"><link rel="prefetch" href="/assets/js/141.8e4d75b9.js"><link rel="prefetch" href="/assets/js/142.83530f40.js"><link rel="prefetch" href="/assets/js/143.7c173663.js"><link rel="prefetch" href="/assets/js/144.2f3f7052.js"><link rel="prefetch" href="/assets/js/145.cfd7fd4d.js"><link rel="prefetch" href="/assets/js/146.beded037.js"><link rel="prefetch" href="/assets/js/147.bb629f5d.js"><link rel="prefetch" href="/assets/js/148.f9eaf4a6.js"><link rel="prefetch" href="/assets/js/149.c32d056f.js"><link rel="prefetch" href="/assets/js/15.29d46668.js"><link rel="prefetch" href="/assets/js/150.9e8fd1d5.js"><link rel="prefetch" href="/assets/js/151.7ddadbf1.js"><link rel="prefetch" href="/assets/js/152.4cdea0b2.js"><link rel="prefetch" href="/assets/js/153.20ed70a0.js"><link rel="prefetch" href="/assets/js/154.da8fb617.js"><link rel="prefetch" href="/assets/js/155.6434a5e4.js"><link rel="prefetch" href="/assets/js/156.48d7ae00.js"><link rel="prefetch" href="/assets/js/157.bdef5aef.js"><link rel="prefetch" href="/assets/js/158.ea38b600.js"><link rel="prefetch" href="/assets/js/159.62a5224a.js"><link rel="prefetch" href="/assets/js/16.cd6ae33a.js"><link rel="prefetch" href="/assets/js/160.8c5ad686.js"><link rel="prefetch" href="/assets/js/161.97be7ce4.js"><link rel="prefetch" href="/assets/js/162.fbf93ae3.js"><link rel="prefetch" href="/assets/js/163.918582a9.js"><link rel="prefetch" href="/assets/js/164.72f6a0bc.js"><link rel="prefetch" href="/assets/js/165.f827ebab.js"><link rel="prefetch" href="/assets/js/166.15d06ffe.js"><link rel="prefetch" href="/assets/js/167.7df80607.js"><link rel="prefetch" href="/assets/js/168.863f80be.js"><link rel="prefetch" href="/assets/js/169.ab705a84.js"><link rel="prefetch" href="/assets/js/17.ef754595.js"><link rel="prefetch" href="/assets/js/170.12e580e7.js"><link rel="prefetch" href="/assets/js/171.11a30b2a.js"><link rel="prefetch" href="/assets/js/172.9807ea7e.js"><link rel="prefetch" href="/assets/js/173.84c6c833.js"><link rel="prefetch" href="/assets/js/174.fdcf6905.js"><link rel="prefetch" href="/assets/js/175.18d4a0fd.js"><link rel="prefetch" href="/assets/js/176.2f11ad7e.js"><link rel="prefetch" href="/assets/js/177.349808b6.js"><link rel="prefetch" href="/assets/js/178.92f16f7d.js"><link rel="prefetch" href="/assets/js/18.748745ae.js"><link rel="prefetch" href="/assets/js/19.0dc2491a.js"><link rel="prefetch" href="/assets/js/20.58a81011.js"><link rel="prefetch" href="/assets/js/21.6791ffce.js"><link rel="prefetch" href="/assets/js/22.b7737885.js"><link rel="prefetch" href="/assets/js/23.13c52e18.js"><link rel="prefetch" href="/assets/js/24.b5cc4189.js"><link rel="prefetch" href="/assets/js/25.5179744c.js"><link rel="prefetch" href="/assets/js/26.15071d70.js"><link rel="prefetch" href="/assets/js/27.5dc790d0.js"><link rel="prefetch" href="/assets/js/28.f661e5a0.js"><link rel="prefetch" href="/assets/js/29.ccd17902.js"><link rel="prefetch" href="/assets/js/3.03c42818.js"><link rel="prefetch" href="/assets/js/30.133e4b80.js"><link rel="prefetch" href="/assets/js/31.97ad996e.js"><link rel="prefetch" href="/assets/js/32.aa847bf2.js"><link rel="prefetch" href="/assets/js/33.caff8a6f.js"><link rel="prefetch" href="/assets/js/34.c39015f6.js"><link rel="prefetch" href="/assets/js/35.99dce353.js"><link rel="prefetch" href="/assets/js/36.25276d0a.js"><link rel="prefetch" href="/assets/js/37.3ee0cf49.js"><link rel="prefetch" href="/assets/js/38.5312a451.js"><link rel="prefetch" href="/assets/js/39.cb875e0c.js"><link rel="prefetch" href="/assets/js/4.55b24f61.js"><link rel="prefetch" href="/assets/js/40.7bb1ce63.js"><link rel="prefetch" href="/assets/js/41.1476e2aa.js"><link rel="prefetch" href="/assets/js/42.94ec0921.js"><link rel="prefetch" href="/assets/js/43.57464c8f.js"><link rel="prefetch" href="/assets/js/44.49edbd69.js"><link rel="prefetch" href="/assets/js/45.7d9bf1e6.js"><link rel="prefetch" href="/assets/js/46.82129287.js"><link rel="prefetch" href="/assets/js/47.c81e8da4.js"><link rel="prefetch" href="/assets/js/48.97bc83ad.js"><link rel="prefetch" href="/assets/js/49.d8bbad3b.js"><link rel="prefetch" href="/assets/js/5.2d78771d.js"><link rel="prefetch" href="/assets/js/50.f29dd3d7.js"><link rel="prefetch" href="/assets/js/51.6d4d9750.js"><link rel="prefetch" href="/assets/js/52.b738267c.js"><link rel="prefetch" href="/assets/js/53.07789ac4.js"><link rel="prefetch" href="/assets/js/54.88b3b39c.js"><link rel="prefetch" href="/assets/js/55.4b5a5bd1.js"><link rel="prefetch" href="/assets/js/56.19136ce9.js"><link rel="prefetch" href="/assets/js/57.b2d4e97d.js"><link rel="prefetch" href="/assets/js/58.a71287e5.js"><link rel="prefetch" href="/assets/js/59.5d05a341.js"><link rel="prefetch" href="/assets/js/6.a2648412.js"><link rel="prefetch" href="/assets/js/60.36566b7b.js"><link rel="prefetch" href="/assets/js/61.7fb8bd5e.js"><link rel="prefetch" href="/assets/js/62.79c495ea.js"><link rel="prefetch" href="/assets/js/63.818f4818.js"><link rel="prefetch" href="/assets/js/64.2e1edce8.js"><link rel="prefetch" href="/assets/js/65.ff262b83.js"><link rel="prefetch" href="/assets/js/66.60acc120.js"><link rel="prefetch" href="/assets/js/67.deb435db.js"><link rel="prefetch" href="/assets/js/68.eb6c7329.js"><link rel="prefetch" href="/assets/js/69.7d811fcb.js"><link rel="prefetch" href="/assets/js/7.fd97ac92.js"><link rel="prefetch" href="/assets/js/70.c35e94a7.js"><link rel="prefetch" href="/assets/js/71.1de0d635.js"><link rel="prefetch" href="/assets/js/72.5a76251b.js"><link rel="prefetch" href="/assets/js/73.6ddc25d9.js"><link rel="prefetch" href="/assets/js/74.8b6a24a3.js"><link rel="prefetch" href="/assets/js/75.729ca7db.js"><link rel="prefetch" href="/assets/js/76.e7124283.js"><link rel="prefetch" href="/assets/js/77.6864f29c.js"><link rel="prefetch" href="/assets/js/78.2465a4d6.js"><link rel="prefetch" href="/assets/js/79.56801182.js"><link rel="prefetch" href="/assets/js/80.b1714fa0.js"><link rel="prefetch" href="/assets/js/81.d20c21da.js"><link rel="prefetch" href="/assets/js/82.de9be220.js"><link rel="prefetch" href="/assets/js/83.53811558.js"><link rel="prefetch" href="/assets/js/84.ac8c69ec.js"><link rel="prefetch" href="/assets/js/85.3c2e589a.js"><link rel="prefetch" href="/assets/js/86.27d25c85.js"><link rel="prefetch" href="/assets/js/87.b1a6cc13.js"><link rel="prefetch" href="/assets/js/88.58582737.js"><link rel="prefetch" href="/assets/js/89.efc33e31.js"><link rel="prefetch" href="/assets/js/9.ea793fe0.js"><link rel="prefetch" href="/assets/js/90.75a19669.js"><link rel="prefetch" href="/assets/js/91.22469024.js"><link rel="prefetch" href="/assets/js/92.7e49cbb7.js"><link rel="prefetch" href="/assets/js/93.fe94d538.js"><link rel="prefetch" href="/assets/js/94.45248260.js"><link rel="prefetch" href="/assets/js/95.7fb3b93f.js"><link rel="prefetch" href="/assets/js/96.11147273.js"><link rel="prefetch" href="/assets/js/97.49775c49.js"><link rel="prefetch" href="/assets/js/98.8f9ef363.js"><link rel="prefetch" href="/assets/js/99.01b8e783.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60dd0459.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="assets/logo.jpg" alt="Valjeanth's blog" class="logo"> <span class="site-name can-hide">Valjeanth's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/net/" class="nav-link router-link-active">
  网络方面
</a></div><div class="nav-item"><a href="/advance/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  lifeRain
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue 知识
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react 知识
</a></div><div class="nav-item"><a href="/computerBase/" class="nav-link">
  碰到的问题
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css基础
</a></div><div class="nav-item"><a href="/accumulate/" class="nav-link">
  js基础
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法基础
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/net/TCP简介.html" class="active sidebar-link">TCP 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/net/TCP简介.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#序列号与确认应答" class="sidebar-link">序列号与确认应答</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#重发超时如何确定" class="sidebar-link">重发超时如何确定</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#连接管理" class="sidebar-link">连接管理</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#tcp-以段为单位发送数据" class="sidebar-link">TCP 以段为单位发送数据</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#窗口提供速度" class="sidebar-link">窗口提供速度</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#流控制" class="sidebar-link">流控制</a></li><li class="sidebar-sub-header"><a href="/net/TCP简介.html#拥塞控制" class="sidebar-link">拥塞控制</a></li></ul></li><li><a href="/net/TCP的报文.html" class="sidebar-link">TCP 的报文</a></li><li><a href="/net/TCP的连接管理.html" class="sidebar-link">TCP 的连接管理</a></li><li><a href="/net/TCP的窗口滑动.html" class="sidebar-link">/net/TCP的窗口滑动.html</a></li><li><a href="/net/TCP的超时时间.html" class="sidebar-link">TCP 的超时时间</a></li><li><a href="/net/TCP的拥塞机制.html" class="sidebar-link">/net/TCP的拥塞机制.html</a></li><li><a href="/net/http状态码.html" class="sidebar-link">http 的转态码</a></li><li><a href="/net/http首部.html" class="sidebar-link">http 的首部</a></li><li><a href="/net/http的get和post的区别.html" class="sidebar-link">get 和 post 区别</a></li><li><a href="/net/http和https.html" class="sidebar-link">http 和 https</a></li><li><a href="/net/http的版本.html" class="sidebar-link">htpp 1.0/1.1/2.0/3.0</a></li><li><a href="/net/CDN原理.html" class="sidebar-link">CDN 原理</a></li><li><a href="/net/DNS原理.html" class="sidebar-link">DNS 的原理</a></li><li><a href="/net/cookie的作用.html" class="sidebar-link">cookie 的作用</a></li><li><a href="/net/SSL加密.html" class="sidebar-link">SSL 加密</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp-简介"><a href="#tcp-简介" class="header-anchor">#</a> TCP 简介</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>tcp 里面的东西还是蛮多的，这里先做一个大体的介绍。</p> <p>没一个小部分，还是可以拿出来加深理解总结的。</p> <h2 id="序列号与确认应答"><a href="#序列号与确认应答" class="header-anchor">#</a> 序列号与确认应答</h2> <p>首先， tcp 是要在不可靠的 ip 协议上提供可靠传输的。</p> <p>因此，tcp 主要就是针对如何可靠传输，以及更高效的可靠传输做了一些实现。</p> <p>序列号就是其一。</p> <p>可以想象一下，你对另一个人说话，如果另一个人始终默不作声，你怎么知道他有没有听到你说的话呢？</p> <p>很容易想打，如果对方能回一句 嗯，你大概就知道他听到了，至于听没听进去，那就不关我们的事了。</p> <p>确认应答就是这个 “嗯”</p> <p>确认应答在 tcp 首部里有一个字段 ACK .即 acknowledge</p> <hr> <p>如果在一定时间内，发送方没有拿到这个 ACK, 就会认为。包已经丢了，至于是自己的包丢了，还是应答的包丢了，它也不清楚。</p> <p>总之，肯定是有包丢了，这时候，发送方只有重发一份了。</p> <p>但是再想一下，一定是包丢了吗，可不可能是网速有点慢呢?</p> <p>如果是这种情况的话，发送方就会一直发送重复的包。</p> <p>这样对接收方就是一场灾难了，它会接收好多相同的数据包。所以，它得识别哪些是重复的包，并把它们丢掉。</p> <p>于是我们的序列号就起作用了。</p> <p>发送方在发送包的时候，在 首部 加上一个序列号，和数据的长度，告诉发送方，这个包是哪块数据。</p> <p>接收方就可以在接受到之后，把序列号加数据长度放在首部并 + 1，告诉发送方，前面的数据已经接受到了，请发送下一部分的数据。</p> <p><img src="/assets/img/tcpqueue.1c7e69df.jpg" alt=""></p> <hr> <p>上面是 tcp 为了保证可靠传输做的一个方面，我们继续看</p> <h2 id="重发超时如何确定"><a href="#重发超时如何确定" class="header-anchor">#</a> 重发超时如何确定</h2> <p>上面遗留了一个问题，就是一定时间没收到应答，发送方就会重传。</p> <p>这个一定时间是多少呢？</p> <p>最好的办法当然是，这个时间内，应答信号刚好能到发送方。</p> <p>当然，这只是理想情况，由于网络的不稳定，应答信号的到达时间是不同的。</p> <p>我们只能折中一下，尽量去找一个最小的时间。为了能找的更准确，我们这个时间最好是能随网速改边而改变。</p> <p>所以，在每次发包时，都会计算往返时间及其偏差，将这两个时间相加，重发超时的时间比这个大一点即可。</p> <p>在 unxi 和 windows 中，重传都是以 0.5 s 为单位进行控制的。因此重传时间的是它的整数倍。</p> <p>然后就是若发生了一次重传，发生会认为网上较慢，会对重传时间进行加倍。也就是 <strong>超时加倍</strong></p> <p>最后，这个加倍也不可能无限制的，达到一定重传此时后，如果仍然没有应答，会判断网络发生异常，强制关闭连接。</p> <h2 id="连接管理"><a href="#连接管理" class="header-anchor">#</a> 连接管理</h2> <p>稳定传输还有一个重要的点，就是得先知道对方是能和自己交流的。比如打电话的时候，经常会发生如下对话。</p> <p>A: 我是 vajeanth， 能听见我说话吗？</p> <p>B：valjeanth， 你好啊，我是 sofia，我听的见你说话，你能听见我说话吗？</p> <p>A: 嗯，我能听的见你说话。</p> <p>....  开始通话内容。</p> <p>tcp 的连接也是如此，要确认双方都能通信，就少不了上面三步的验证。</p> <p>tcp 里叫三次握手。具体流程安照上面的打电话走一遍</p> <ol><li><p>客户端发送一个 tcp 包，SYN = 1, 请求和服务器连接。</p></li> <li><p>服务器收到后，返回一个 tcp 包，ACK = 1,(针对客户端 SYN 应答)， SYN = 1, 请求和客户端连接。</p></li> <li><p>客户端收到后，发送一个 tcp 包 ACK = 1（针对服务器 SYN 应答）</p></li></ol> <p>连接成功之后就可以互相通信了。</p> <hr> <p>当通信完成后，tcp 还要关闭连接的。叫 tcp 四次挥手。</p> <ol><li><p>客户端发送 tcp 包，FIN = 1 ,告诉服务器，我没有数据要发了，请求断开连接。</p></li> <li><p>服务收到后，发送 ACK, 告诉客户端知道了。不再接受客户端数据</p></li></ol> <p>此时，客户端还是可以接受数据的</p> <p>如果，服务器也没数据发送了，</p> <ol start="3"><li><p>服务器发送 tcp 包，FIN = 1, 告诉客户端，我也没数据要发了，请求断开连接。</p></li> <li><p>客户端收到后，发送 ACK = 1 , 告诉服务器，我知道了，不再接受服务器数据</p></li></ol> <p>至此，tcp 连接就断开了。</p> <hr> <p><img src="/assets/img/tcpconnect.d4e5840b.jpg" alt=""></p> <p>总结一下，一个连接的建立与断开至少要来回发送 7 个包。</p> <h2 id="tcp-以段为单位发送数据"><a href="#tcp-以段为单位发送数据" class="header-anchor">#</a> TCP 以段为单位发送数据</h2> <p>这里讨论一下，tcp 包，一个包发送多少数据合适。</p> <p>最理想的情况是，这个数据的长度刚好不会被 ip 分片处理。</p> <p>tcp 包传输数据的最大长度我们叫 MSS (maximum segment size)。</p> <p>这个 MSS 会在握手阶段计算出，双方会发送自己的接口能适应的 MSS 大小，然后选择较小的那个作为 MSS.</p> <h2 id="窗口提供速度"><a href="#窗口提供速度" class="header-anchor">#</a> 窗口提供速度</h2> <p>tcp 以段为单位，每发一个段进行一确认应答处理有一个缺陷。</p> <p>超时等待这段时间啥也没干。</p> <p>这样通信的效率是很低的。</p> <p>因此，tcp 采用窗口传输来提升速率，就是一次发送多个包，这个发送送包的大小就是窗口的大小。       。</p> <p>当然，带来的问题是数据顺序的乱序。因为网络是不稳定的，很可能后发的包先到了</p> <p>解决办法，是一种叫做 <strong>滑动窗口</strong> 的机制，会单独拿出来做详细介绍。这里先带过。</p> <h2 id="流控制"><a href="#流控制" class="header-anchor">#</a> 流控制</h2> <p>上面说到，用窗口可以大大提高传输效率，那么窗口设置为多大比较合适呢？</p> <p>这个就要考虑接收端了。如果接受端的缓冲区满了，还没来得及被上层取出来用。</p> <p>那么即使你发送再多数据，接收方也会因为接收不了选择丢弃，于是又会引发重传。</p> <p>所以，最好的是，发接受端能通知一下，你缓冲区还能接受几段数据。我下次就把窗口设为这个，一并发给你</p> <p>TCP 首部中，专门有一个 16位字段 来通知窗口大小。</p> <p>当接受端发送的报文显示窗口大小是 0 时，发送方会等待一个超时的时间。</p> <p>如果过了该时间，接收端还是没告诉自己接受的窗口大小，发送端会发送一个字节数据的包，叫做窗口探测。</p> <p>如果窗口还是 0 就会再等待一个超时，一旦接收端缓存区更新，就会发送窗口更新通知，发送方继续发送数据。</p> <p><img src="/assets/img/tcpflow.fe54bdce.jpg" alt=""></p> <h2 id="拥塞控制"><a href="#拥塞控制" class="header-anchor">#</a> 拥塞控制</h2> <p>现在，我们有了窗口来加速数据的传输。</p> <p>但是，如果一开始就发送大量的数据包会引发一些其他问题。</p> <p>一般来说，计算机网络都处于一个共享的环境中，因此也有可能会因为其他主机间的通信使得网络拥堵。</p> <p>在网络拥堵的时候，如果突然发送一个较大量的数据，极有可能导致整个网络瘫痪。</p> <hr> <p>所以，TCP 采取了一种慢启动的算法得到数值，对发送数据量进行控制。</p> <p>具体流程大致如下：</p> <ol><li><p>首先，定义一个拥塞窗口，开始的时候，这个窗口只有一个数据段(或者稍微大些)，开始发送的窗口就是这个拥塞窗口</p></li> <li><p>发送方每收到一个应答，拥塞窗口就会+1，也就是说，拥塞窗口会随之发送指数增长，1 -&gt; 2 -&gt; 4 -&gt; 8</p></li> <li><p>发送数据时，会将拥塞窗口和接收方通知的窗口进行比较，选择较小的作为发送窗口。</p></li> <li><p>如果发送超时重传，说明网络开始拥堵，拥塞窗口重新置 1 ，再发送。</p></li> <li><p>为了避免拥塞窗口增长太快，会设置一个阈值，一旦到达这个阈值，增长数目 = 1个数据段字节数^2/拥塞窗口字节数</p></li> <li><p>5 中超过阈值的增长是线性的。且刚开始的时候是没设置阈值的，发生重传后，阈值为当前拥塞窗口一半。</p></li> <li><p>如果收到重复确认应答造成的重发，此时网络拥堵较为轻，那么阈值设为其一半，窗口大小设为阈值+3</p></li></ol> <hr> <p><img src="/assets/img/tcpcrowd.95f450ba.jpg" alt=""></p> <p>经过拥塞机制的优化，TCP 会在带宽好的时候，逐步占据带宽，网络拥堵的时候又及时放弃带宽。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/" class="prev router-link-active">
        Home
      </a></span> <span class="next"><a href="/net/TCP的报文.html">
        TCP 的报文
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ca42ae6.js" defer></script><script src="/assets/js/2.515f669a.js" defer></script><script src="/assets/js/8.2b28110d.js" defer></script>
  </body>
</html>
